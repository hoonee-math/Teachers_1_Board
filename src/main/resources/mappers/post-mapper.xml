<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="post">
	<resultMap id="postCommentMap" type="comment1">
		<id column="comment-no" property="commentNo"/>
		<result column="parent-no" property="parentNo"/>
		<result column="comment" property="comment"/>
		<result column="create_date" property="createDate"/>
		<result column="update_date" property="updateDate"/>
		<result column="level" property="level"/>
		<association column="member" property="member1.memberMap"/>
		<association column="post" property="postMap"/>
	</resultMap>
	<resultMap id="postMap" type="post1">
		<id column="post_no" property="postNo"/>
		<result column="category_no" property="categoryNo"/>
		<result column="post_title" property="postTitle"/>
		<result column="post_content" property="postContent"/>
		<result column="view_count" property="viewCount"/>
		<result column="like_count" property="likeCount"/>
		<result column="create_date" property="createDate"/>
		<result column="update_date" property="updateDate"/>
		<result column="status" property="status"/>
		<result column="is_public" property="isPublic"/>
		<result column="is_Notice" property="isNotice"/>
		<result column="comment_count" property="commentCount"/>
		<association property="member" resultMap="member1.memberMap"/>
		<association property="school" resultMap="school12.schoolMap"/>
		<collection property="images" resultMap="image1.imageMap"/>
		<collection property="comments" resultMap="postCommentMap"/>
	</resultMap>
	
	<select id="selectRegion" resultType="string">
		SELECT DISTINCT REGION FROM SCHOOL12
	</select>
	
	<select id="selectDistrict" parameterType="string" resultType="string">
		SELECT DISTINCT DISTRICT
		FROM SCHOOL12
		WHERE REGION LIKE
		CASE #{region}
			WHEN '서울' THEN '서울%'
			WHEN '경기' THEN '경기%'
			WHEN '인천' THEN '인천%'
			WHEN '부산' THEN '부산%'
			WHEN '세종' THEN '세종%'
			WHEN '광주' THEN '광주%'
			WHEN '대구' THEN '대구%'
			WHEN '대전' THEN '대전%'
			WHEN '울산' THEN '울산%'
			WHEN '강원' THEN '강원%'
			WHEN '충남' THEN '충청남도'
			WHEN '충북' THEN '충청북도'
			WHEN '경남' THEN '경상남도'
			WHEN '경북' THEN '경상북도'
			WHEN '전남' THEN '전라남도'
			WHEN '전북' THEN '전%북%'
			WHEN '제주' THEN '제주%'
		END
		ORDER BY DISTRICT
	</select>
	
	<select id="selectSchool" parameterType="string" resultType="string">
		SELECT DISTINCT SCHOOL_NAME
		FROM SCHOOL12
		WHERE DISTRICT = #{district}
		AND SCHOOL_NAME LIKE '%' || #{schoolName}
		ORDER BY SCHOOL_NAME
	</select>
	
	<select id="selectImgAll" resultMap="image.imageMap">
		SELECT * FROM IMAGE1
	</select>
	
	<insert id="insertPost" parameterType="post1">
		INSERT INTO POST1 (
			POST_NO,
			POST_TITLE,
			POST_CONTENT,
			CREATE_DATE,
			MEMBNER_NO,
			CATEGORY_NO
		) VALUES (
			SEQ_POST_NO.NEXTVAL, 
			#{postTitle}, 
			#{postContent},
			SYSDATE,
			#{childMember.memberNo},
			#{categoryNo}
		)
	</insert>
	
	<select id="selectBoardJoinCommentJoinMember" parameterType="_int" resultMap="postMap">
		SELECT * FROM POST1
		LEFT JOIN (SELECT * FROM COMMENT1
			START WITH LEVEL=1
			CONNECT BY PRIOR COMMENT_NO=PARENT_NO)
		ON POST_NO=PARENT_NO
		LEFT JOIN MEMBER1 USING (MEMBER_NO)
		WHERE POST_NO=#{postNo}
	</select>
</mapper>